<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... (código anterior permanece o mesmo) ... -->
</head>
<body>
    <!-- ... (código anterior permanece o mesmo) ... -->

    <script>
        // ... (código anterior permanece o mesmo) ...

        function startWebSocket() {
            if (ws) {
                ws.close();
            }

            const protocol = 'wss:';
            const host = window.location.host;
            const wsUrl = `${protocol}//${host}/${selectedRoute}`;
            
            console.log('Attempting to connect to WebSocket URL:', wsUrl);

            try {
                ws = new WebSocket(wsUrl);

                ws.onopen = () => {
                    console.log('WebSocket connection established successfully');
                    startSendingFrames();
                };

                ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                    displayMessage('Erro na conexão WebSocket.', true);
                };

                ws.onclose = (event) => {
                    console.log('WebSocket connection closed', event);
                    displayMessage('Conexão WebSocket fechada.', true);
                };
            } catch (error) {
                console.error('Error creating WebSocket:', error);
                displayMessage('Erro ao criar conexão WebSocket.', true);
            }
        }

        // ... (resto do código permanece o mesmo) ...
    </script>
</body>
</html>