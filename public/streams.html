<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... (código anterior permanece o mesmo) ... -->
</head>
<body>
    <!-- ... (código anterior permanece o mesmo) ... -->

    <script>
        // ... (código anterior permanece o mesmo) ...

        function startWebSocket() {
            if (ws) {
                ws.close();
            }

            // Usar 'wss://' para WebSocket seguro
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/${selectedRoute}`;
            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                console.log('WebSocket connection established');
                startSendingFrames();
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
                displayMessage('Erro na conexão WebSocket.', true);
            };

            ws.onclose = () => {
                console.log('WebSocket connection closed');
            };
        }

        // ... (o resto do código permanece o mesmo) ...
    </script>
</body>
</html>